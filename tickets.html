<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Билеты | Velocity Railways</title>
    <link rel="stylesheet" href="/styles/css/tickets.css">
    <link rel="icon" type="image/svg+xml" href="/img/favicon.svg">
</head>
<body>
    <div id="preloader">
        <svg
                class="group-1"
                width="64"
                height="64"
                viewBox="0 0 64 64"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
            >
                <path
                d="M61.1639 29.7844L35.6407 7.42503C30.1269 2.57887 23.5852 -0.0111481 16.8872 3.60689e-05H0V5.62503H16.8872C22.692 5.61523 28.3614 7.85896 33.1407 12.0575L35.4284 14.0625H15.4485V19.6875H41.8488L58.6628 34.4188C59.0378 34.7472 59.3205 35.2198 59.4697 35.7676C59.6188 36.3154 59.6265 36.9096 59.4916 37.4634C59.3568 38.0172 59.0864 38.5015 58.7201 38.8454C58.3538 39.1894 57.9108 39.3749 57.4558 39.375H0V45H57.4558C58.8525 44.9995 60.2124 44.4297 61.3369 43.3739C62.4613 42.3181 63.2913 40.8317 63.7055 39.1318C64.1197 37.432 64.0964 35.6079 63.6391 33.9261C63.1817 32.2443 62.3147 30.793 61.1639 29.7844Z"
                fill="#F5F5F5"
                id="LogoTrain"
                />
                <path
                d="M63 53H1V58.5H5.42857V64H9.85714V58.5H20.9286V64H25.3571V58.5H36.4286V64H40.8571V58.5H51.9286V64H56.3571V58.5H63V53Z"
                fill="#F5F5F5"
                />
            </svg>
    </div>
    <header>
        <a href="/index.html">
            <svg
                class="group-1"
                width="64"
                height="64"
                viewBox="0 0 64 64"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
            >
                <path
                d="M61.1639 29.7844L35.6407 7.42503C30.1269 2.57887 23.5852 -0.0111481 16.8872 3.60689e-05H0V5.62503H16.8872C22.692 5.61523 28.3614 7.85896 33.1407 12.0575L35.4284 14.0625H15.4485V19.6875H41.8488L58.6628 34.4188C59.0378 34.7472 59.3205 35.2198 59.4697 35.7676C59.6188 36.3154 59.6265 36.9096 59.4916 37.4634C59.3568 38.0172 59.0864 38.5015 58.7201 38.8454C58.3538 39.1894 57.9108 39.3749 57.4558 39.375H0V45H57.4558C58.8525 44.9995 60.2124 44.4297 61.3369 43.3739C62.4613 42.3181 63.2913 40.8317 63.7055 39.1318C64.1197 37.432 64.0964 35.6079 63.6391 33.9261C63.1817 32.2443 62.3147 30.793 61.1639 29.7844Z"
                fill="#F5F5F5"
                />
                <path
                d="M63 53H1V58.5H5.42857V64H9.85714V58.5H20.9286V64H25.3571V58.5H36.4286V64H40.8571V58.5H51.9286V64H56.3571V58.5H63V53Z"
                fill="#F5F5F5"
                />
            </svg>
            </a>

            <svg
                class="menu"
                id="menu"
                width="48"
                height="49"
                viewBox="0 0 48 49"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                >
                <path
                    d="M6 24.5H42M6 12.5H42M6 36.5H42"
                    stroke="#F5F5F5"
                    stroke-width="4"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                />
            </svg>

            <nav id="headerMenu">
                <ul>
                    <a href="/tickets.html"><li id="menuBttn1">Оформить билеты</li></a>
                    <a href="/routes.html"><li id="menuBttn2">Маршруты</li></a>
                    <a href="/partners.html"><li id="menuBttn3">Наши партнеры</li></a>
                    <a href="/aboutus.html"><li id="menuBttn4">О нас</li></a>
                </ul>
            </nav>
    </header>

    <main>
         <h2>Оформить билеты</h2>

        <div id="filter">
            <label for="cityFilter">Направления:</label>
            <select id="cityFilter">
                <option value="all">Все</option>
            </select>
        </div>

         <div id="blox">
            
         </div>

         <div id="modal" class="modal">
            <div class="modal-content">
                <form action="/payment.html" id="ticketForm">
                <h2 id="formRoute"></h2>
                <p id="formDeparture"></p>
                <p id="formComming"></p>
                <p id="formDays"></p>
                <div>
                <p id="pDate">Выберите дату поездки</p>
                <select id="dateSelect" name="date" required>
                    </select>
                </div>
                <p>Оставьте свои данные</p>
                <div>
                    <p id="pFio">ФИО</p>
                    <input type="text" name="name" id="fio" placeholder="Иванов Иван Иванович" required>
                    <small class="error-message" id="fioError"></small>
                </div>

                <div>
                    <p id="pPhone">Номер телефона</p>
                    <input type="text" name="phone" id="phone" value="+375" required>
                    <small class="error-message" id="phoneError"></small>
                </div>

                <p id="formPrice"></p>
                <button type="button" class="close-button">Х</button>
                <button type="submit">Оформить</button>
                </form>
            </div>
    </main>

    <footer>
        <div id="footerLogo">
            <svg
                class="group-22"
                width="74"
                height="77"
                viewBox="0 0 74 77"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                >
                <path
                    d="M69.9796 35.9205L40.8635 9.33006C34.5734 3.56686 27.1109 0.486742 19.4701 0.500043H0.205566V7.18945H19.4701C26.092 7.1778 32.5595 9.8461 38.0115 14.8391L40.6213 17.2236H17.8288V23.913H47.9455L67.1264 41.4319C67.5542 41.8223 67.8768 42.3844 68.0469 43.0359C68.217 43.6873 68.2258 44.394 68.072 45.0526C67.9181 45.7112 67.6097 46.2871 67.1918 46.6961C66.774 47.1051 66.2686 47.3258 65.7495 47.3259H0.205566V54.0153H65.7495C67.3428 54.0147 68.8942 53.3371 70.177 52.0816C71.4597 50.826 72.4065 49.0583 72.879 47.0367C73.3516 45.0152 73.325 42.8459 72.8033 40.8459C72.2815 38.8459 71.2924 37.12 69.9796 35.9205Z"
                    fill="#F5F5F5"
                />
                <path
                    d="M72.0743 63.5291H1.34637V70.0698H6.39837V76.6106H11.4504V70.0698H24.0803V76.6106H29.1323V70.0698H41.7623V76.6106H46.8143V70.0698H59.4443V76.6106H64.4963V70.0698H72.0743V63.5291Z"
                    fill="#F5F5F5"
                />
            </svg>
            <p id="underLogoText">Velocity Railways</p>
        </div>
        <ul id="footerMenu">
            <a href="/tickets.html"><li id="footerMenuLink1">Оформить билеты</li></a>
            <a href="/routes.html"><li id="footerMenuLink2">Маршруты</li></a>
            <a href="/aboutus.html"><li id="footerMenuLink3">О компании</li></a>
            <a href="/team.html"><li id="footerMenuLink4">Сотрудники</li></a>
            <a href="/partners.html"><li id="footerMenuLink5">Партнеры</li></a>
        </ul>
    </footer>

    <script>
        let burgerBttn = document.getElementById("menu")
        let navbar = document.getElementById("headerMenu")
        let menuClickFlag = false

        burgerBttn.addEventListener("click", function(){
            if(menuClickFlag == false){
                burgerBttn.classList.add("clicked")
                navbar.classList.add("menuClicked")
                menuClickFlag = true
            }
            else {
                burgerBttn.classList.remove("clicked")
                navbar.classList.remove("menuClicked")
                menuClickFlag = false
            }
            
        })
        window.addEventListener('load', function () {
            let preloader = document.getElementById('preloader')
            setTimeout(() => {preloader.classList.add('done');}, 500);
            setTimeout(() => {console.log(preloader.style.display = 'none');}, 2000);
        });

        

        document.addEventListener('DOMContentLoaded', function() {
        let selectedTicketData = null;

        // Генерация билетов
        fetch('tickets.xml')
            .then(response => response.text())
            .then(xmlString => {
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlString, "text/xml");
                const tickets = xmlDoc.getElementsByTagName('ticket');
                const container = document.getElementById('blox');
                const cityFilter = document.getElementById('cityFilter');

                // Создаем список
                const cities = new Set();
                Array.from(tickets).forEach(ticket => {
                    const route = ticket.getElementsByTagName('route')[0].textContent;
                    const [from, to] = route.split('-');
                    cities.add(from.trim());
                    cities.add(to.trim());
                });

                // Добавляем города в список
                cities.forEach(city => {
                    const option = document.createElement('option');
                    option.value = city;
                    option.textContent = city;
                    cityFilter.appendChild(option);
                });

                // Функция создания блока билетов
                const createTicketElement = (ticket) => {
                    const getValue = tag => ticket.getElementsByTagName(tag)[0]?.textContent || '';

                    return `
                    <div class="ticket" 
                        data-route="${getValue('route')}"
                        data-departure="${getValue('departure')}"
                        data-comming="${getValue('comming')}"
                        data-days="${getValue('days')}"
                        data-price="${getValue('price')}">
                        <p id="route">Маршрут: ${getValue('route')}</p>
                        <p id="departure">Время отправление: ${getValue('departure')}</p>
                        <p id="comming">Время прибытия: ${getValue('comming')}</p>
                        <p id="days">Дни курсирования: ${getValue('days')}</p>
                        <p id="price">${getValue('price')}</p>
                        <button class="buy-button">Оформить</button>
                    </div>
                    `;
                };

                // Добавление билетов
                const displayTickets = (filterCity = 'all') => {
                    container.innerHTML = '';
                    Array.from(tickets).forEach(ticket => {
                        const route = ticket.getElementsByTagName('route')[0].textContent;
                        const [from, to] = route.split('-');
                        if (filterCity === 'all' || from.trim() === filterCity || to.trim() === filterCity) {
                            container.innerHTML += createTicketElement(ticket);
                        }
                    });
                };

                
                displayTickets();

                // Обработчик изменения фильтра
                cityFilter.addEventListener('change', function() {
                    displayTickets(this.value);
                });

                // Обработчик клика
                container.addEventListener('click', function(e) {
                    if (e.target.classList.contains('buy-button')) {
                        const ticketElement = e.target.closest('.ticket');
                        selectedTicketData = {
                            route: ticketElement.dataset.route,
                            departure: ticketElement.dataset.departure,
                            comming: ticketElement.dataset.comming,
                            days: ticketElement.dataset.days,
                            price: ticketElement.dataset.price
                        };
                        openModal();
                    }
                });
            });

        // Функции для работы с модальным окном
        const generateAvailableDates = (days) => {
            const dateSelect = document.getElementById('dateSelect');
            dateSelect.innerHTML = '';

            const daysOfWeek = days.split(',').map(day => day.trim()); // Получаем дни курсирования
            const dayMap = {
                'пн': 1,
                'вт': 2,
                'ср': 3,
                'чт': 4,
                'пт': 5,
                'сб': 6,
                'вс': 0
            };

            const today = new Date();
            for (let i = 0; i < 14; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);

                const dayOfWeek = date.getDay(); // 0 (воскресенье) - 6 (суббота)
                if (daysOfWeek.some(day => dayMap[day] === dayOfWeek)) {
                    const option = document.createElement('option');
                    option.value = date.toISOString().split('T')[0]; // Формат YYYY-MM-DD
                    option.textContent = date.toLocaleDateString('ru-RU'); // Формат DD.MM.YYYY
                    dateSelect.appendChild(option);
                }
            }
        };

        function openModal() {
            const modal = document.getElementById('modal');
            modal.style.display = 'flex';

            // Заполняем форму данными
            document.getElementById('formRoute').textContent = selectedTicketData.route;
            document.getElementById('formDeparture').textContent = `Время отправления: ${selectedTicketData.departure}`;
            document.getElementById('formComming').textContent = `Время прибытия: ${selectedTicketData.comming}`;
            document.getElementById('formDays').textContent = `Дни курсирования: ${selectedTicketData.days}`;
            document.getElementById('formPrice').textContent = `${selectedTicketData.price}`;
            generateAvailableDates(selectedTicketData.days);
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
            selectedTicketData = null;
        }

        // Обработчики закрытия модалки
        document.querySelector('.modal').addEventListener('click', function(e) {
            if (e.target.classList.contains('modal') || e.target.classList.contains('close-button')) {
                closeModal();
            }
        });
    });

    document.addEventListener('DOMContentLoaded', function() {
        const fioInput = document.getElementById('fio');
        const phoneInput = document.getElementById('phone');

        // Функция для валидации ФИО
        function validateFIO(fio) {
            const regex = /^[A-Za-zА-Яа-яЁё\s]{2,100}$/;
            return regex.test(fio);
        }

        // Функция для валидации номера телефона
        function validatePhone(phone) {
            const regex = /^\+375\d{9}$/;
            return regex.test(phone);
        }

         phoneInput.addEventListener('input', function() {
            let phone = phoneInput.value.trim();
            // Форматируем номер телефона
            if (phone.startsWith('375') && phone.length === 12) {
                phone = '+375' + phone.slice(3);
            }
            phoneInput.value = phone;
        });


        // Обработчик отправки формы
        const ticketForm = document.getElementById('ticketForm');
        ticketForm.addEventListener('submit', function(event) {
            event.preventDefault(); // Предотвращаем отправку формы

            // Получаем значения полей
            const fio = fioInput.value.trim();
            const phone = phoneInput.value.trim();
            const dateSelect = document.getElementById('dateSelect').value;
            let sucsFio = false;
            let sucsPhone = false;

            // Проверяем ФИО
            if (!validateFIO(fio)) {
                fioInput.value = '';
                fioInput.placeholder = 'В ФИО только буквы';
            } else {
                fioInput.placeholder = '';
                sucsFio = true;
            }

            // Проверяем номер телефона
            if (!validatePhone(phone)) {
                phoneInput.value = '';
                phoneInput.placeholder = 'Только +375XXXXXXXXX';
            } else {
                phoneInput.placeholder = '';
                sucsPhone = true;
            }

            // Проверяем дату
            if (!dateSelect) {
                return;
            }

            // Если все проверки пройдены, отправляем форму
            if(sucsFio && sucsPhone){
                ticketForm.submit();
            }
        });
    });
    </script>
</body>
</html>